# 数据库知识-基础篇

## 角色

> 角色是权限的集合，可以简化授权的过程。

- MySQL8才开始支持

### 1. 创建角色

```sql
CREATE ROLE <角色名>
```

### 2. 给角色授权

```sql
GRANT <权限>
ON <对象类型>对象名
TO <角色>[, <角色>]
```

### 3. 将角色授予其他的角色或者用户

```sql
GRANT <角色>[, <角色>]
ON <角色>[, <用户>]
[WITH ADMIN OPTION]
```

> WITH ADMIN OPTION, 获得某种权限的角色或用户还可以把这种权限再授予其他的角色。

### 4. 角色权限的收回

```sql
REVOKE <权限>[, <权限>]
ON <对象类型><对象名>
FROM <角色>[, <角色>]
```

> REVOEKE的执行者或是角色的创建者，或是拥有在这个角色上的ADMIN OPTION。

## 审计

> 审计功能把用户对数据库的所有操作自动记录下来放入审计日志（audit log）中。

- 目前MySQL没有审计功能，需要插件安装

## 触发器

> 触发器（trigger）是用户定义在关系表上的一类由事件驱动的特殊过程。
> 触发器又叫事件-条件-动作（event-condition-action）规则。

- MySQL5开始支持

### 1. 创建trigger一般格式

```sql
CREATE TRIGGER <触发器名>
{BEFORE | AFTER} <触发事件> ON <表名>
REFERENCING NEW | OLD ROW AS <变量>
FOR EACH {ROW | STATEMENT}
[WHEN<触发条件>] <触发动作体>
```

- MySQL例子

```sql
CREATE TRIGGER upd_check BEFORE UPDATE ON account
       FOR EACH ROW
       BEGIN
           IF NEW.amount < 0 THEN
               SET NEW.amount = 0;
           ELSEIF NEW.amount > 100 THEN
               SET NEW.amount = 100;
           END IF;
       END;
```

### 2. 删除trigger

```sql
DROP TRIGGER <NAME>
```

### 3. 其他

- MySQL中查看所有触发器

```sql
SHOW TRIGGERS
```
